<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#0a0a1a"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="××¢×§×‘ ×©×¢×•×ª"/>
  <title>ğŸŒŒ ××¢×§×‘ ×©×¢×•×ª ×¢×‘×•×“×”</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg1:     #0a0a1a;
      --bg2:     #12122a;
      --card:    #1a1a3e;
      --indigo:  #6366f1;
      --purple:  #a855f7;
      --cyan:    #22d3ee;
      --orange:  #f59e0b;
      --red:     #ef4444;
      --green:   #10b981;
      --muted:   #8888bb;
      --white:   #ffffff;
    }

    html, body {
      min-height: 100%;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 50%, var(--bg1) 100%);
      color: var(--white);
      direction: rtl;
    }

    body { padding: 12px; padding-bottom: 40px; }

    /* Stars background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.6) 0%, transparent 100%),
        radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.5) 0%, transparent 100%),
        radial-gradient(1px 1px at 50% 70%, rgba(255,255,255,0.4) 0%, transparent 100%),
        radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.5) 0%, transparent 100%),
        radial-gradient(1px 1px at 90% 50%, rgba(255,255,255,0.3) 0%, transparent 100%),
        radial-gradient(1px 1px at 35% 15%, rgba(255,255,255,0.6) 0%, transparent 100%),
        radial-gradient(1px 1px at 65% 85%, rgba(255,255,255,0.4) 0%, transparent 100%),
        radial-gradient(2px 2px at 70% 25%, rgba(99,102,241,0.8) 0%, transparent 100%),
        radial-gradient(2px 2px at 25% 60%, rgba(168,85,247,0.6) 0%, transparent 100%),
        radial-gradient(2px 2px at 85% 75%, rgba(34,211,238,0.5) 0%, transparent 100%);
      pointer-events: none;
      z-index: 0;
    }

    .container { position: relative; z-index: 1; max-width: 600px; margin: 0 auto; }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, #0d0d2b, #1a1a4e);
      border: 1px solid rgba(99,102,241,0.4);
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 20px rgba(99,102,241,0.2);
    }

    .header-title { font-size: 18px; font-weight: 700; }
    .header-title span {
      background: linear-gradient(to left, var(--cyan), var(--indigo));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }

    #clock {
      font-family: 'Consolas', monospace;
      font-size: 22px;
      font-weight: 700;
      direction: ltr;
      background: linear-gradient(to left, var(--indigo), var(--cyan));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }

    /* CARDS */
    .card {
      background: rgba(26,26,62,0.85);
      border: 1px solid rgba(99,102,241,0.35);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 12px;
      box-shadow: 0 0 16px rgba(99,102,241,0.15);
      backdrop-filter: blur(6px);
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--white);
      margin-bottom: 14px;
      text-align: center;
    }

    /* STATUS */
    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
    }

    .status-in  { background: rgba(16,185,129,0.2); color: #34d399; border: 1px solid #10b981; }
    .status-out { background: rgba(239,68,68,0.2);  color: #f87171; border: 1px solid #ef4444; }

    .today-hours {
      font-family: Consolas, monospace;
      font-size: 13px;
      color: var(--cyan);
      direction: ltr;
    }

    /* BUTTONS */
    .btn {
      width: 100%;
      height: 46px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      font-family: inherit;
      color: white;
      cursor: pointer;
      margin-bottom: 8px;
      transition: opacity 0.15s, transform 0.1s;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active { opacity: 0.75; transform: scale(0.98); }
    .btn:disabled { opacity: 0.3; cursor: default; }

    .btn-in      { background: linear-gradient(to left, var(--cyan), #059669); }
    .btn-out     { background: linear-gradient(to left, var(--orange), var(--red)); }
    .btn-save    { background: linear-gradient(to left, var(--cyan), var(--indigo)); }
    .btn-sick    { background: #d97706; }
    .btn-vac     { background: #7c3aed; }
    .btn-clear   { background: #374151; }
    .btn-nav     { background: rgba(26,26,78,0.8); border: 1px solid rgba(99,102,241,0.3); width: auto; padding: 0 20px; }

    /* TIME INPUTS */
    .time-row { display: flex; gap: 10px; margin-bottom: 10px; }
    .time-field { flex: 1; }
    .time-field label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px; }
    .time-field input {
      width: 100%;
      background: rgba(13,13,43,0.8);
      border: 1px solid var(--indigo);
      border-radius: 8px;
      color: white;
      font-family: Consolas, monospace;
      font-size: 18px;
      padding: 8px;
      text-align: center;
      direction: ltr;
      outline: none;
    }

    .time-field input:focus { border-color: var(--cyan); box-shadow: 0 0 0 2px rgba(34,211,238,0.2); }

    .save-msg { text-align: center; font-size: 13px; color: var(--cyan); min-height: 20px; margin-bottom: 6px; }

    /* STATS */
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .stat-box { background: rgba(13,13,43,0.6); border-radius: 10px; padding: 10px 12px; }
    .stat-label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .stat-value { font-family: Consolas, monospace; font-size: 20px; font-weight: 700; }
    .stat-cyan   { color: var(--cyan); }
    .stat-purple { color: var(--purple); }
    .stat-orange { color: var(--orange); }
    .stat-indigo { color: var(--indigo); }

    /* PROGRESS BAR */
    .progress-wrap { margin-bottom: 14px; }
    .progress-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .progress-track {
      height: 10px; border-radius: 5px;
      background: rgba(99,102,241,0.15);
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      border-radius: 5px;
      background: linear-gradient(to left, var(--cyan), var(--indigo));
      transition: width 0.5s ease;
      box-shadow: 0 0 8px rgba(99,102,241,0.5);
    }

    /* MONTH NAV */
    .month-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .month-title { font-size: 16px; font-weight: 700; }

    /* TABLE */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .history-table th {
      background: rgba(13,13,43,0.8);
      color: var(--muted);
      font-weight: 700;
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid rgba(99,102,241,0.2);
    }

    .history-table td {
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid rgba(99,102,241,0.08);
      font-family: Consolas, monospace;
    }

    .history-table tr:hover td { background: rgba(99,102,241,0.08); cursor: pointer; }
    .history-table tr.selected td { background: rgba(99,102,241,0.2); }
    .history-table tr.today-row td { background: rgba(34,211,238,0.05); }

    .status-work    { color: var(--cyan); }
    .status-sick    { color: var(--orange); }
    .status-vac     { color: var(--purple); }
    .status-weekend { color: #4b5563; }
    .status-pending { color: var(--indigo); }

    .divider { height: 1px; background: rgba(99,102,241,0.25); margin: 10px 0; }

    /* SELECTED INFO */
    .selected-date { font-size: 12px; color: var(--muted); text-align: center; margin-bottom: 10px; min-height: 18px; }

    @media (min-width: 480px) {
      body { padding: 20px; }
      .card { padding: 22px; }
    }
  </style>
</head>
<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="header-title">ğŸŒŒ <span>××¢×§×‘ ×©×¢×•×ª ×¢×‘×•×“×”</span></div>
    <div id="clock">00:00:00</div>
  </div>

  <!-- CLOCK IN/OUT CARD -->
  <div class="card">
    <div class="card-title">×›× ×™×¡×” / ×™×¦×™××”</div>

    <div class="status-row">
      <div id="work-status" class="status-badge status-out">×œ× ×‘×¢×‘×•×“×” ğŸ”´</div>
      <div class="today-hours" id="today-display">×”×™×•×: --:-- - --:--</div>
    </div>

    <button class="btn btn-in"  id="btn-in"  onclick="clockIn()">ğŸŸ¢  ×›× ×™×¡×” ×œ×¢×‘×•×“×”</button>
    <button class="btn btn-out" id="btn-out" onclick="clockOut()" disabled>ğŸ”´  ×™×¦×™××” ××”×¢×‘×•×“×”</button>
  </div>

  <!-- STATS CARD -->
  <div class="card">
    <div class="card-title">×¡×˜×˜×™×¡×˜×™×§×•×ª ×—×•×“×©×™×•×ª</div>

    <div class="progress-wrap">
      <div class="progress-header">
        <span id="progress-label">×”×ª×§×“××•×ª</span>
        <span id="progress-pct">0%</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progress-fill" style="width:0%"></div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-label">×©×¢×•×ª ×©× ×¢×‘×“×•</div>
        <div class="stat-value stat-cyan"  id="stat-worked">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™×¢×“ ×—×•×“×©×™</div>
        <div class="stat-value stat-purple" id="stat-target">0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">× ×•×ª×¨×•</div>
        <div class="stat-value stat-orange" id="stat-remain">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×××•×¦×¢ ×™×•××™</div>
        <div class="stat-value stat-indigo" id="stat-avg">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™××™ ××—×œ×”</div>
        <div class="stat-value stat-orange" id="stat-sick">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™××™ ×—×•×¤×©×”</div>
        <div class="stat-value stat-purple" id="stat-vac">0</div>
      </div>
    </div>
  </div>

  <!-- EDIT DAY CARD -->
  <div class="card">
    <div class="card-title">×¢×¨×™×›×ª ×™×•× × ×‘×—×¨</div>
    <div class="selected-date" id="selected-date">×‘×—×¨ ×™×•× ××”×˜×‘×œ×” ×œ××˜×”</div>

    <div class="time-row">
      <div class="time-field">
        <label>×›× ×™×¡×” (HH:mm)</label>
        <input type="text" id="input-in" placeholder="08:00" maxlength="5"/>
      </div>
      <div class="time-field">
        <label>×™×¦×™××” (HH:mm)</label>
        <input type="text" id="input-out" placeholder="17:00" maxlength="5"/>
      </div>
    </div>

    <div class="save-msg" id="save-msg"></div>
    <button class="btn btn-save" onclick="saveManualHours()">ğŸ’¾  ×©××•×¨ ×©×¢×•×ª</button>

    <div class="divider"></div>

    <button class="btn btn-sick"  onclick="markDay('sick')">ğŸ¥  ×¡××Ÿ ×›××—×œ×” (9 ×©×¢×•×ª)</button>
    <button class="btn btn-vac"   onclick="markDay('vacation')">ğŸ–ï¸  ×¡××Ÿ ×›×—×•×¤×©×” (9 ×©×¢×•×ª)</button>
    <button class="btn btn-clear" onclick="markDay('clear')" style="margin-bottom:0">ğŸ—‘ï¸  × ×§×” ×™×•×</button>
  </div>

  <!-- HISTORY CARD -->
  <div class="card">
    <div class="month-nav">
      <button class="btn btn-nav" onclick="navigateMonth(1)">â€º</button>
      <div class="month-title" id="month-title"></div>
      <button class="btn btn-nav" onclick="navigateMonth(-1)">â€¹</button>
    </div>

    <div style="overflow-x:auto;">
      <table class="history-table">
        <thead>
          <tr>
            <th>×ª××¨×™×š</th>
            <th>×™×•×</th>
            <th>×›× ×™×¡×”</th>
            <th>×™×¦×™××”</th>
            <th>×©×¢×•×ª</th>
            <th>×¡×˜×˜×•×¡</th>
          </tr>
        </thead>
        <tbody id="history-body"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
  // â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const STORAGE_KEY = 'workHoursData';
  const DAY_NAMES   = ['×¨××©×•×Ÿ','×©× ×™','×©×œ×™×©×™','×¨×‘×™×¢×™','×—××™×©×™','×©×™×©×™','×©×‘×ª'];
  const MONTH_NAMES = ['','×™× ×•××¨','×¤×‘×¨×•××¨','××¨×¥','××¤×¨×™×œ','×××™','×™×•× ×™','×™×•×œ×™','××•×’×•×¡×˜','×¡×¤×˜××‘×¨','××•×§×˜×•×‘×¨','× ×•×‘××‘×¨','×“×¦××‘×¨'];

  let allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  let viewYear, viewMonth;
  let currentMonth = [];
  let selectedIndex = -1;

  // â”€â”€ Clock â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateClock() {
    const now = new Date();
    const hh  = String(now.getHours()).padStart(2,'0');
    const mm  = String(now.getMinutes()).padStart(2,'0');
    const ss  = String(now.getSeconds()).padStart(2,'0');
    document.getElementById('clock').textContent = `${hh}:${mm}:${ss}`;
    updateTodayDisplay();
  }

  setInterval(updateClock, 1000);
  updateClock();

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function init() {
    const now  = new Date();
    viewYear   = now.getFullYear();
    viewMonth  = now.getMonth() + 1;
    loadMonth();
  }

  // â”€â”€ Month â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getKey(y, m) { return `${y}-${String(m).padStart(2,'0')}`; }

  function loadMonth() {
    const key   = getKey(viewYear, viewMonth);
    const saved = allData[key] || {};
    const days  = getDaysInMonth(viewYear, viewMonth);
    const today = new Date();

    currentMonth = [];
    for (let d = 1; d <= days; d++) {
      const date   = new Date(viewYear, viewMonth - 1, d);
      const dow    = date.getDay(); // 0=Sun,6=Sat
      const dateStr = `${viewYear}-${String(viewMonth).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const saved_day = saved[dateStr] || {};
      const isWeekend = dow === 5 || dow === 6;
      const isFuture  = date > today && !isSameDay(date, today);

      let status = saved_day.status || (isWeekend ? 'weekend' : isFuture ? 'pending' : 'pending');

      currentMonth.push({
        date:     dateStr,
        dow:      dow,
        dayName:  DAY_NAMES[dow],
        clockIn:  saved_day.clockIn  || null,
        clockOut: saved_day.clockOut || null,
        status:   status
      });
    }

    document.getElementById('month-title').textContent = `${MONTH_NAMES[viewMonth]} ${viewYear}`;
    updateTodayButtons();
    renderTable();
    updateStats();
  }

  function getDaysInMonth(y, m) { return new Date(y, m, 0).getDate(); }
  function isSameDay(a, b) { return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }

  function navigateMonth(dir) {
    viewMonth += dir;
    if (viewMonth > 12) { viewMonth = 1;  viewYear++; }
    if (viewMonth < 1)  { viewMonth = 12; viewYear--; }
    selectedIndex = -1;
    document.getElementById('selected-date').textContent = '×‘×—×¨ ×™×•× ××”×˜×‘×œ×” ×œ××˜×”';
    document.getElementById('input-in').value  = '';
    document.getElementById('input-out').value = '';
    loadMonth();
  }

  // â”€â”€ Clock In/Out â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clockIn() {
    const today = getTodayEntry();
    if (!today) return;
    const now = timeStr(new Date());
    today.clockIn  = now;
    today.clockOut = null;
    today.status   = 'work';
    saveAndRefresh();
    updateTodayButtons();
  }

  function clockOut() {
    const today = getTodayEntry();
    if (!today) return;
    today.clockOut = timeStr(new Date());
    saveAndRefresh();
    updateTodayButtons();
  }

  function getTodayEntry() {
    const now = new Date();
    const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

    // if viewing current month
    if (viewYear === now.getFullYear() && viewMonth === now.getMonth()+1) {
      return currentMonth.find(d => d.date === dateStr) || null;
    }
    return null;
  }

  function updateTodayButtons() {
    const today = getTodayEntry();
    const isClockedIn = today && today.clockIn && !today.clockOut;

    document.getElementById('btn-in').disabled  = isClockedIn || (today && (today.status === 'sick' || today.status === 'vacation'));
    document.getElementById('btn-out').disabled = !isClockedIn;

    const statusEl = document.getElementById('work-status');
    if (isClockedIn) {
      statusEl.textContent = '×‘×¢×‘×•×“×” ğŸŸ¢';
      statusEl.className   = 'status-badge status-in';
    } else {
      statusEl.textContent = '×œ× ×‘×¢×‘×•×“×” ğŸ”´';
      statusEl.className   = 'status-badge status-out';
    }
  }

  function updateTodayDisplay() {
    const today = getTodayEntry();
    const el = document.getElementById('today-display');
    if (!today) { el.textContent = ''; return; }
    el.textContent = `×”×™×•×: ${today.clockIn || '--:--'} - ${today.clockOut || '--:--'}`;
  }

  function timeStr(date) {
    return `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
  }

  // â”€â”€ Manual edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveManualHours() {
    if (selectedIndex < 0) { showMsg('×‘×—×¨ ×™×•× ×§×•×“×'); return; }
    const day = currentMonth[selectedIndex];
    if (day.status === 'weekend') { showMsg('×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×¡×•×£ ×©×‘×•×¢'); return; }

    const inVal  = document.getElementById('input-in').value.trim();
    const outVal = document.getElementById('input-out').value.trim();

    if (inVal  && !/^\d{1,2}:\d{2}$/.test(inVal))  { showMsg('âš ï¸ ×¤×•×¨××˜ ×›× ×™×¡×” ×©×’×•×™ (HH:mm)'); return; }
    if (outVal && !/^\d{1,2}:\d{2}$/.test(outVal)) { showMsg('âš ï¸ ×¤×•×¨××˜ ×™×¦×™××” ×©×’×•×™ (HH:mm)'); return; }

    day.clockIn  = inVal  || null;
    day.clockOut = outVal || null;
    if (inVal || outVal) day.status = 'work';

    saveAndRefresh();
    showMsg('âœ… × ×©××¨ ×‘×”×¦×œ×—×”!');
    updateTodayButtons();
  }

  function markDay(type) {
    if (selectedIndex < 0) { showMsg('×‘×—×¨ ×™×•× ×§×•×“×'); return; }
    const day = currentMonth[selectedIndex];
    if (day.status === 'weekend') { showMsg('×œ× × ×™×ª×Ÿ ×œ×¡××Ÿ ×¡×•×£ ×©×‘×•×¢'); return; }

    if (type === 'sick')     { day.status = 'sick';    day.clockIn = null; day.clockOut = null; }
    if (type === 'vacation') { day.status = 'vacation'; day.clockIn = null; day.clockOut = null; }
    if (type === 'clear')    {
      const date = new Date(day.date);
      const now  = new Date();
      day.status   = (date > now) ? 'pending' : 'pending';
      day.clockIn  = null;
      day.clockOut = null;
    }

    document.getElementById('input-in').value  = '';
    document.getElementById('input-out').value = '';
    saveAndRefresh();
    showMsg('âœ… ×¢×•×“×›×Ÿ!');
  }

  function showMsg(msg) {
    const el = document.getElementById('save-msg');
    el.textContent = msg;
    setTimeout(() => { el.textContent = ''; }, 3000);
  }

  // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function calcHours(day) {
    if (day.status === 'sick' || day.status === 'vacation') return 9.0;
    if (day.clockIn && day.clockOut) {
      const [ih, im] = day.clockIn.split(':').map(Number);
      const [oh, om] = day.clockOut.split(':').map(Number);
      return Math.max(0, (oh * 60 + om - ih * 60 - im) / 60);
    }
    return 0;
  }

  function updateStats() {
    const workDays  = currentMonth.filter(d => d.status !== 'weekend' && d.status !== 'pending' || d.status === 'sick' || d.status === 'vacation' || d.status === 'work');
    const planned   = currentMonth.filter(d => d.status !== 'weekend');
    const target    = planned.length * 9;
    const worked    = currentMonth.reduce((s, d) => s + calcHours(d), 0);
    const remain    = Math.max(0, target - worked);
    const daysWorked= currentMonth.filter(d => calcHours(d) > 0).length;
    const avg       = daysWorked > 0 ? worked / daysWorked : 0;
    const pct       = target > 0 ? Math.min(100, (worked / target) * 100) : 0;
    const sickDays  = currentMonth.filter(d => d.status === 'sick').length;
    const vacDays   = currentMonth.filter(d => d.status === 'vacation').length;

    document.getElementById('stat-worked').textContent = worked.toFixed(1) + 'h';
    document.getElementById('stat-target').textContent = target.toFixed(0) + 'h';
    document.getElementById('stat-remain').textContent = remain.toFixed(1) + 'h';
    document.getElementById('stat-avg').textContent    = avg.toFixed(1) + 'h';
    document.getElementById('stat-sick').textContent   = sickDays;
    document.getElementById('stat-vac').textContent    = vacDays;
    document.getElementById('progress-pct').textContent = pct.toFixed(0) + '%';
    document.getElementById('progress-fill').style.width = pct.toFixed(1) + '%';
  }

  // â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderTable() {
    const today = new Date();
    const tbody = document.getElementById('history-body');
    tbody.innerHTML = '';

    currentMonth.forEach((day, i) => {
      const date     = new Date(day.date);
      const hours    = calcHours(day);
      const hoursStr = hours > 0 ? hours.toFixed(1) + 'h' : '--';
      const isToday  = isSameDay(date, today);
      const dd       = String(date.getDate()).padStart(2,'0');
      const mm       = String(date.getMonth()+1).padStart(2,'0');

      const statusMap = {
        work:    { cls: 'status-work',    label: 'âœ… ×¢×‘×•×“×”' },
        sick:    { cls: 'status-sick',    label: 'ğŸ¥ ××—×œ×”' },
        vacation:{ cls: 'status-vac',     label: 'ğŸ–ï¸ ×—×•×¤×©×”' },
        weekend: { cls: 'status-weekend', label: 'â›” ×¡×•×¤"×©' },
        pending: { cls: 'status-pending', label: 'â³ ×¢×ª×™×“×™' },
      };
      const s = statusMap[day.status] || statusMap.pending;

      const tr = document.createElement('tr');
      if (isToday)         tr.classList.add('today-row');
      if (i === selectedIndex) tr.classList.add('selected');

      tr.innerHTML = `
        <td>${dd}/${mm}</td>
        <td>${day.dayName}</td>
        <td>${day.clockIn  || '--:--'}</td>
        <td>${day.clockOut || '--:--'}</td>
        <td>${hoursStr}</td>
        <td class="${s.cls}">${s.label}</td>
      `;

      tr.onclick = () => selectDay(i);
      tbody.appendChild(tr);
    });
  }

  function selectDay(i) {
    selectedIndex = i;
    const day = currentMonth[i];
    const date = new Date(day.date);
    const dd = String(date.getDate()).padStart(2,'0');
    const mm = String(date.getMonth()+1).padStart(2,'0');
    document.getElementById('selected-date').textContent = `${dd}/${mm}/${date.getFullYear()} â€” ${day.dayName}`;
    document.getElementById('input-in').value  = day.clockIn  || '';
    document.getElementById('input-out').value = day.clockOut || '';
    document.getElementById('save-msg').textContent = '';
    renderTable();
  }

  // â”€â”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveAndRefresh() {
    const key = getKey(viewYear, viewMonth);
    const obj = {};
    currentMonth.forEach(d => { obj[d.date] = { clockIn: d.clockIn, clockOut: d.clockOut, status: d.status }; });
    allData[key] = obj;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
    renderTable();
    updateStats();
  }

  init();
</script>
</body>
</html>
