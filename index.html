<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#7C3AED"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="××¢×§×‘ ×©×¢×•×ª"/>
  <title>ğŸŒŒ ××¢×§×‘ ×©×¢×•×ª ×¢×‘×•×“×”</title>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --purple:       #7C3AED;
      --purple-dark:  #4C1D95;
      --purple-mid:   #9333EA;
      --purple-light: #EDE9FE;
      --purple-soft:  #F5F3FF;
      --black:        #1a1a2e;
      --text:         #1a1a2e;
      --muted:        #6B7280;
      --white:        #ffffff;
      --green:        #059669;
      --green-light:  #D1FAE5;
      --orange:       #D97706;
      --orange-light: #FEF3C7;
      --red:          #DC2626;
      --red-light:    #FEE2E2;
      --border:       rgba(124,58,237,0.14);
      --shadow:       0 2px 16px rgba(124,58,237,0.08), 0 1px 4px rgba(0,0,0,0.04);
    }

    /* â”€â”€ KEYFRAMES â”€â”€ */
    @keyframes fadeSlideUp {
      from { opacity: 0; transform: translateY(22px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulseGlow {
      0%, 100% { text-shadow: 0 0 8px rgba(124,58,237,0.2); }
      50%       { text-shadow: 0 0 22px rgba(124,58,237,0.7), 0 0 44px rgba(124,58,237,0.25); }
    }
    @keyframes shimmer {
      0%   { background-position: 200% center; }
      100% { background-position: -200% center; }
    }
    @keyframes orbFloat {
      from { transform: translate(0, 0) scale(1); }
      to   { transform: translate(18px, 14px) scale(1.06); }
    }
    @keyframes rippleAnim {
      to { transform: scale(4); opacity: 0; }
    }
    @keyframes iconBounce {
      0%, 100% { transform: translateY(0) scale(1); }
      35%       { transform: translateY(-5px) scale(1.15); }
      65%       { transform: translateY(-2px) scale(1.05); }
    }
    @keyframes headerShine {
      0%   { left: -100%; opacity: 0; }
      10%  { opacity: 1; }
      90%  { opacity: 1; }
      100% { left: 200%; opacity: 0; }
    }
    @keyframes timerPop {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.03); }
      100% { transform: scale(1); }
    }

    html { background: var(--purple-soft); min-height: 100%; }

    body {
      min-height: 100%;
      font-family: 'Assistant', 'Segoe UI', Arial, sans-serif;
      color: var(--text);
      direction: rtl;
      padding: 14px;
      padding-bottom: 82px;
      background: transparent;
      position: relative;
    }

    /* Fixed background â€” doesn't scroll with content */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: var(--purple-soft);
      background-image:
        radial-gradient(ellipse 70% 50% at 10% 8%,  rgba(124,58,237,0.09) 0%, transparent 70%),
        radial-gradient(ellipse 60% 70% at 90% 92%, rgba(147,51,234,0.07) 0%, transparent 70%);
      z-index: -2;
      pointer-events: none;
    }

    /* Animated floating orbs */
    .bg-orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(72px);
      pointer-events: none;
      z-index: -1;
      will-change: transform;
    }
    .orb1 {
      width: 380px; height: 380px;
      background: rgba(124,58,237,0.07);
      top: -130px; right: -110px;
      animation: orbFloat 8s ease-in-out infinite alternate;
    }
    .orb2 {
      width: 300px; height: 300px;
      background: rgba(147,51,234,0.05);
      bottom: 70px; left: -90px;
      animation: orbFloat 10s ease-in-out infinite alternate-reverse;
      animation-delay: -3s;
    }
    .orb3 {
      width: 220px; height: 220px;
      background: rgba(76,29,149,0.04);
      top: 44%; right: 18%;
      animation: orbFloat 13s ease-in-out infinite alternate;
      animation-delay: -6s;
    }

    .container { max-width: 540px; margin: 0 auto; }

    /* â”€â”€ HEADER â”€â”€ */
    .header {
      background: linear-gradient(135deg, var(--purple-dark) 0%, var(--purple-mid) 100%);
      border-radius: 22px;
      padding: 18px 22px;
      margin-bottom: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 6px 24px rgba(124,58,237,0.35);
      position: relative;
      overflow: hidden;
    }
    /* Shine sweep on header */
    .header::after {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 55%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
      animation: headerShine 6s linear infinite;
      pointer-events: none;
    }

    .header-title { font-size: 17px; font-weight: 800; color: rgba(255,255,255,0.9); letter-spacing: 0.2px; position: relative; }
    .header-title span { color: #fff; }

    #clock {
      font-family: 'Assistant', monospace;
      font-size: 24px;
      font-weight: 800;
      direction: ltr;
      color: #fff;
      letter-spacing: 1px;
      background: rgba(255,255,255,0.15);
      padding: 4px 12px;
      border-radius: 10px;
      position: relative;
    }

    /* â”€â”€ CARDS â”€â”€ */
    .card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 12px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: transform 0.22s cubic-bezier(.4,0,.2,1), box-shadow 0.22s cubic-bezier(.4,0,.2,1);
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 36px rgba(124,58,237,0.14), 0 2px 8px rgba(0,0,0,0.05);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0; right: 0;
      width: 4px; height: 100%;
      background: linear-gradient(to bottom, var(--purple-dark), var(--purple-mid));
      border-radius: 0 20px 20px 0;
    }

    .card-title {
      font-size: 15px;
      font-weight: 800;
      color: var(--purple-dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-title::after {
      content: '';
      flex: 1;
      height: 1.5px;
      background: var(--purple-light);
      border-radius: 2px;
    }

    /* â”€â”€ STATUS â”€â”€ */
    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      background: var(--purple-soft);
      border-radius: 12px;
      padding: 10px 14px;
    }
    .status-badge {
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.2px;
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    .status-in      { background: var(--green-light); color: var(--green); border: 1.5px solid rgba(5,150,105,0.4); }
    .status-out     { background: var(--red-light);   color: var(--red);   border: 1.5px solid rgba(220,38,38,0.4); }
    .status-shabbat { background: #FEF9C3; color: #854D0E; border: 1.5px solid rgba(133,77,14,0.35); }
    .today-hours { font-size: 13px; color: var(--purple); font-weight: 700; direction: ltr; }

    /* â”€â”€ SHIFT TIMER â”€â”€ */
    .shift-timer {
      display: none;
      text-align: center;
      padding: 18px 14px;
      margin-bottom: 14px;
      background: linear-gradient(135deg, var(--purple-soft), var(--purple-light));
      border: 1.5px solid rgba(124,58,237,0.25);
      border-radius: 18px;
      animation: fadeSlideUp 0.35s cubic-bezier(.4,0,.2,1) both;
    }
    .shift-timer-label {
      font-size: 11px;
      color: var(--purple);
      margin-bottom: 6px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }
    .shift-timer-value {
      font-size: 44px;
      font-weight: 800;
      direction: ltr;
      color: var(--purple-dark);
      letter-spacing: 3px;
      line-height: 1;
      transition: color 0.3s;
    }
    /* Pulsing glow when shift is active */
    .shift-timer-value.running {
      animation: pulseGlow 2.2s ease-in-out infinite;
    }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn {
      width: 100%;
      height: 50px;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 700;
      font-family: inherit;
      color: white;
      cursor: pointer;
      margin-bottom: 8px;
      position: relative;
      overflow: hidden;
      transition: transform 0.12s, box-shadow 0.12s, opacity 0.12s;
      -webkit-tap-highlight-color: transparent;
      letter-spacing: 0.3px;
    }
    .btn:active { transform: scale(0.97); opacity: 0.88; }
    .btn:disabled { opacity: 0.28; cursor: default; box-shadow: none !important; transform: none !important; }

    .btn-in   { background: linear-gradient(135deg, #047857, #10b981); box-shadow: 0 4px 16px rgba(5,150,105,0.28); }
    .btn-out  { background: linear-gradient(135deg, #b91c1c, #ef4444); box-shadow: 0 4px 16px rgba(220,38,38,0.28); }
    .btn-save { background: linear-gradient(135deg, var(--purple-dark), var(--purple-mid)); box-shadow: 0 4px 16px rgba(124,58,237,0.32); }
    .btn-sick { background: linear-gradient(135deg, #92400e, #d97706); box-shadow: 0 4px 16px rgba(217,119,6,0.28); }
    .btn-vac  { background: linear-gradient(135deg, #5b21b6, #8b5cf6); box-shadow: 0 4px 16px rgba(124,58,237,0.28); }
    .btn-clear{ background: linear-gradient(135deg, #374151, #9ca3af); box-shadow: 0 4px 16px rgba(55,65,81,0.18); }
    .btn-nav  {
      background: var(--white);
      border: 1.5px solid var(--border);
      color: var(--purple-dark);
      width: auto; padding: 0 22px;
      box-shadow: var(--shadow);
      font-size: 18px;
    }

    /* Ripple element */
    .ripple-el {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.38);
      transform: scale(0);
      animation: rippleAnim 0.55s linear forwards;
      pointer-events: none;
    }

    /* â”€â”€ TIME INPUTS â”€â”€ */
    .time-row { display: flex; gap: 10px; margin-bottom: 12px; }
    .time-field { flex: 1; }
    .time-field label { font-size: 11px; color: var(--muted); display: block; margin-bottom: 5px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; }
    .time-field input {
      width: 100%;
      background: var(--purple-soft);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      color: var(--black);
      font-family: 'Assistant', monospace;
      font-size: 20px;
      font-weight: 800;
      padding: 10px 8px;
      text-align: center;
      direction: ltr;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .time-field input:focus { border-color: var(--purple); box-shadow: 0 0 0 3px rgba(124,58,237,0.10); background: var(--white); }

    .save-msg { text-align: center; font-size: 13px; color: var(--purple); min-height: 20px; margin-bottom: 8px; font-weight: 700; }

    /* â”€â”€ STATS â”€â”€ */
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat-box {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 1px 6px rgba(124,58,237,0.07);
      position: relative;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-box:hover { transform: translateY(-2px); box-shadow: 0 5px 18px rgba(124,58,237,0.13); }
    .stat-box::after {
      content: '';
      position: absolute;
      bottom: 0; right: 0; left: 0;
      height: 3px;
      background: linear-gradient(to left, var(--purple-mid), var(--purple-dark));
      border-radius: 0 0 16px 16px;
      opacity: 0.5;
    }
    .stat-label { font-size: 11px; color: var(--muted); margin-bottom: 6px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; }
    .stat-value { font-size: 24px; font-weight: 800; line-height: 1; }
    .stat-cyan   { color: var(--purple-mid); }
    .stat-purple { color: var(--purple-dark); }
    .stat-orange { color: var(--orange); }
    .stat-indigo { color: var(--purple); }
    .stat-green  { color: var(--green); }

    /* â”€â”€ PROGRESS â”€â”€ */
    .progress-wrap { margin-bottom: 18px; }
    .progress-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 8px; font-weight: 700; }
    .progress-track { height: 10px; border-radius: 10px; background: var(--purple-light); overflow: hidden; }
    .progress-fill {
      height: 100%;
      border-radius: 10px;
      background-image: linear-gradient(to left, var(--purple-mid), var(--purple-dark), var(--purple-mid));
      background-size: 200% auto;
      animation: shimmer 2.8s linear infinite;
      transition: width 0.7s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 0 8px rgba(124,58,237,0.35);
    }

    /* â”€â”€ MONTH NAV â”€â”€ */
    .month-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .month-title { font-size: 17px; font-weight: 800; color: var(--purple-dark); }

    /* â”€â”€ TABLE â”€â”€ */
    .history-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 13px; }
    .history-table th {
      background: var(--purple-dark);
      color: rgba(255,255,255,0.9);
      font-weight: 700;
      padding: 10px 6px;
      text-align: center;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .history-table th:first-child { border-radius: 0 12px 0 0; }
    .history-table th:last-child  { border-radius: 12px 0 0 0; }
    .history-table td {
      padding: 10px 6px;
      text-align: center;
      border-bottom: 1px solid var(--purple-soft);
      color: var(--black);
      font-weight: 600;
      font-size: 13px;
      transition: background 0.15s;
    }
    .history-table tbody tr:last-child td:first-child { border-radius: 0 0 0 12px; }
    .history-table tbody tr:last-child td:last-child  { border-radius: 0 0 12px 0; }
    .history-table tr:hover td  { background: var(--purple-soft); cursor: pointer; }
    .history-table tr.selected td { background: var(--purple-light); }
    .history-table tr.today-row td { background: #F0FDF4; }

    .status-work    { color: #047857; font-weight: 700; }
    .status-sick    { color: var(--orange); font-weight: 700; }
    .status-vac     { color: var(--purple-mid); font-weight: 700; }
    .status-weekend { color: #D1D5DB; }
    .status-pending { color: #C4B5FD; }

    .divider { height: 1px; background: var(--purple-light); margin: 14px 0; }

    /* â”€â”€ SELECTED DATE â”€â”€ */
    .selected-date {
      font-size: 13px;
      color: var(--white);
      text-align: center;
      margin-bottom: 14px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--purple-dark), var(--purple-mid));
      padding: 8px 16px;
      border-radius: 10px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* â”€â”€ TABS â”€â”€ */
    .tab-panel { display: none; }
    .tab-panel.active {
      display: block;
      animation: fadeSlideUp 0.38s cubic-bezier(.4,0,.2,1) both;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 68px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
      box-shadow: 0 -2px 20px rgba(124,58,237,0.08);
      padding: 0 8px;
    }
    .tab-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      background: none;
      border: none;
      color: #C4B5FD;
      font-family: inherit;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      border-radius: 14px;
      margin: 8px 4px;
      transition: background 0.2s, color 0.2s, transform 0.12s;
      -webkit-tap-highlight-color: transparent;
    }
    .tab-btn .tab-icon { font-size: 20px; line-height: 1; display: inline-block; }
    .tab-btn.active { color: var(--purple-dark); background: var(--purple-light); }
    .tab-btn.active .tab-icon { animation: iconBounce 0.42s cubic-bezier(.4,0,.2,1) both; }
    .tab-btn:active { transform: scale(0.91); }

    @media (min-width: 480px) {
      body { padding: 20px; padding-bottom: 88px; }
    }
  </style>
</head>
<body>
<!-- Fixed background orbs -->
<div class="bg-orb orb1"></div>
<div class="bg-orb orb2"></div>
<div class="bg-orb orb3"></div>

<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="header-title">ğŸŒŒ <span>××¢×§×‘ ×©×¢×•×ª ×¢×‘×•×“×”</span></div>
    <div id="clock">00:00:00</div>
  </div>

  <!-- TAB 1: ×”×™×•× -->
  <div class="tab-panel active" id="tab-today">

  <!-- CLOCK IN/OUT CARD -->
  <div class="card">
    <div class="card-title">×›× ×™×¡×” / ×™×¦×™××”</div>

    <div class="status-row">
      <div id="work-status" class="status-badge status-out">×œ× ×‘×¢×‘×•×“×” ğŸ”´</div>
      <div class="today-hours" id="today-display">×”×™×•×: --:-- - --:--</div>
    </div>

    <div class="shift-timer" id="shift-timer">
      <div class="shift-timer-label">â± ×–××Ÿ ×‘××©××¨×ª</div>
      <div class="shift-timer-value" id="shift-timer-value">00:00:00</div>
    </div>

    <button class="btn btn-in"  id="btn-in"  onclick="clockIn()">ğŸŸ¢  ×›× ×™×¡×” ×œ×¢×‘×•×“×”</button>
    <button class="btn btn-out" id="btn-out" onclick="clockOut()" disabled>ğŸ”´  ×™×¦×™××” ××”×¢×‘×•×“×”</button>
  </div>

  </div> <!-- end tab-today -->

  <!-- TAB 2: ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
  <div class="tab-panel" id="tab-stats">

  <!-- STATS CARD -->
  <div class="card">
    <div class="card-title">×¡×˜×˜×™×¡×˜×™×§×•×ª ×—×•×“×©×™×•×ª</div>

    <div class="progress-wrap">
      <div class="progress-header">
        <span id="progress-label">×”×ª×§×“××•×ª</span>
        <span id="progress-pct">0%</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progress-fill" style="width:0%"></div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-label">×©×¢×•×ª ×©× ×¢×‘×“×•</div>
        <div class="stat-value stat-cyan"  id="stat-worked">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™×¢×“ ×—×•×“×©×™</div>
        <div class="stat-value stat-purple" id="stat-target">0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">× ×•×ª×¨×•</div>
        <div class="stat-value stat-orange" id="stat-remain">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×××•×¦×¢ ×™×•××™</div>
        <div class="stat-value stat-indigo" id="stat-avg">0.0h</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™××™ ××—×œ×”</div>
        <div class="stat-value stat-orange" id="stat-sick">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">×™××™ ×—×•×¤×©×”</div>
        <div class="stat-value stat-purple" id="stat-vac">0</div>
      </div>
    </div>
  </div>

  </div> <!-- end tab-stats -->

  <!-- TAB 3: ×œ×•×— ×—×•×“×©×™ -->
  <div class="tab-panel" id="tab-history">

  <!-- EDIT DAY CARD -->
  <div class="card">
    <div class="card-title">×¢×¨×™×›×ª ×™×•× × ×‘×—×¨</div>
    <div class="selected-date" id="selected-date">×‘×—×¨ ×™×•× ××”×˜×‘×œ×” ×œ××˜×”</div>

    <div class="time-row">
      <div class="time-field">
        <label>×›× ×™×¡×” (HH:mm)</label>
        <input type="text" id="input-in" placeholder="08:00" maxlength="5"/>
      </div>
      <div class="time-field">
        <label>×™×¦×™××” (HH:mm)</label>
        <input type="text" id="input-out" placeholder="17:00" maxlength="5"/>
      </div>
    </div>

    <div class="save-msg" id="save-msg"></div>
    <button class="btn btn-save" onclick="saveManualHours()">ğŸ’¾  ×©××•×¨ ×©×¢×•×ª</button>

    <div class="divider"></div>

    <button class="btn btn-sick"  onclick="markDay('sick')">ğŸ¥  ×¡××Ÿ ×›××—×œ×” (9 ×©×¢×•×ª)</button>
    <button class="btn btn-vac"   onclick="markDay('vacation')">ğŸ–ï¸  ×¡××Ÿ ×›×—×•×¤×©×” (9 ×©×¢×•×ª)</button>
    <button class="btn btn-clear" onclick="markDay('clear')" style="margin-bottom:0">ğŸ—‘ï¸  × ×§×” ×™×•×</button>
  </div>

  <!-- HISTORY CARD -->
  <div class="card">
    <div class="month-nav">
      <button class="btn btn-nav" onclick="navigateMonth(1)">â€º</button>
      <div class="month-title" id="month-title"></div>
      <button class="btn btn-nav" onclick="navigateMonth(-1)">â€¹</button>
    </div>

    <div style="overflow-x:auto;">
      <table class="history-table">
        <thead>
          <tr>
            <th>×ª××¨×™×š</th>
            <th>×™×•×</th>
            <th>×›× ×™×¡×”</th>
            <th>×™×¦×™××”</th>
            <th>×©×¢×•×ª</th>
            <th>×¡×˜×˜×•×¡</th>
          </tr>
        </thead>
        <tbody id="history-body"></tbody>
      </table>
    </div>
  </div>

  </div> <!-- end tab-history -->

</div> <!-- end container -->

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="tab-btn active" id="nav-today"   onclick="switchTab('today')">
    <span class="tab-icon">ğŸ•</span>×“×•×— ×™×•××™
  </button>
  <button class="tab-btn"        id="nav-stats"   onclick="switchTab('stats')">
    <span class="tab-icon">ğŸ“Š</span>×¡×˜×˜×™×¡×˜×™×§×•×ª
  </button>
  <button class="tab-btn"        id="nav-history" onclick="switchTab('history')">
    <span class="tab-icon">ğŸ“…</span>×œ×•×— ×—×•×“×©×™
  </button>
</nav>

<script>
  // â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(name) {
    ['today','stats','history'].forEach(t => {
      const panel = document.getElementById('tab-' + t);
      const nav   = document.getElementById('nav-' + t);
      const isActive = t === name;
      panel.classList.toggle('active', isActive);
      nav.classList.toggle('active', isActive);
      // Re-trigger tab icon bounce
      if (isActive) {
        const icon = nav.querySelector('.tab-icon');
        icon.style.animation = 'none';
        void icon.offsetWidth;
        icon.style.animation = '';
      }
    });
  }

  // â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const STORAGE_KEY = 'workHoursData';
  const DAY_NAMES   = ['×¨××©×•×Ÿ','×©× ×™','×©×œ×™×©×™','×¨×‘×™×¢×™','×—××™×©×™','×©×™×©×™','×©×‘×ª'];
  const MONTH_NAMES = ['','×™× ×•××¨','×¤×‘×¨×•××¨','××¨×¥','××¤×¨×™×œ','×××™','×™×•× ×™','×™×•×œ×™','××•×’×•×¡×˜','×¡×¤×˜××‘×¨','××•×§×˜×•×‘×¨','× ×•×‘××‘×¨','×“×¦××‘×¨'];

  let allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  let viewYear, viewMonth;
  let currentMonth = [];
  let selectedIndex = -1;
  let shiftStartTime = null;

  // â”€â”€ Clock â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateClock() {
    const now = new Date();
    const hh  = String(now.getHours()).padStart(2,'0');
    const mm  = String(now.getMinutes()).padStart(2,'0');
    const ss  = String(now.getSeconds()).padStart(2,'0');
    document.getElementById('clock').textContent = `${hh}:${mm}:${ss}`;
    updateTodayDisplay();
    updateShiftTimer();
  }

  function updateShiftTimer() {
    const timerEl  = document.getElementById('shift-timer');
    const timerVal = document.getElementById('shift-timer-value');
    if (!shiftStartTime) {
      timerEl.style.display = 'none';
      timerVal.classList.remove('running');
      return;
    }
    timerEl.style.display = 'block';
    timerVal.classList.add('running');
    const elapsed = Math.max(0, Math.floor((Date.now() - shiftStartTime) / 1000));
    const h = Math.floor(elapsed / 3600);
    const m = Math.floor((elapsed % 3600) / 60);
    const s = elapsed % 60;
    timerVal.textContent =
      `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  setInterval(updateClock, 1000);
  updateClock();

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function init() {
    const now  = new Date();
    viewYear   = now.getFullYear();
    viewMonth  = now.getMonth() + 1;
    loadMonth();
  }

  // â”€â”€ Month â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getKey(y, m) { return `${y}-${String(m).padStart(2,'0')}`; }

  function loadMonth() {
    const key   = getKey(viewYear, viewMonth);
    const saved = allData[key] || {};
    const days  = getDaysInMonth(viewYear, viewMonth);
    const today = new Date();

    currentMonth = [];
    for (let d = 1; d <= days; d++) {
      const date   = new Date(viewYear, viewMonth - 1, d);
      const dow    = date.getDay(); // 0=Sun,6=Sat
      const dateStr = `${viewYear}-${String(viewMonth).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const saved_day = saved[dateStr] || {};
      const isWeekend = dow === 5 || dow === 6;
      const isFuture  = date > today && !isSameDay(date, today);

      let status = saved_day.status || (isWeekend ? 'weekend' : isFuture ? 'pending' : 'pending');

      currentMonth.push({
        date:     dateStr,
        dow:      dow,
        dayName:  DAY_NAMES[dow],
        clockIn:  saved_day.clockIn  || null,
        clockOut: saved_day.clockOut || null,
        status:   status
      });
    }

    document.getElementById('month-title').textContent = `${MONTH_NAMES[viewMonth]} ${viewYear}`;
    updateTodayButtons();
    renderTable();
    updateStats();
  }

  function getDaysInMonth(y, m) { return new Date(y, m, 0).getDate(); }
  function isSameDay(a, b) { return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }

  function navigateMonth(dir) {
    viewMonth += dir;
    if (viewMonth > 12) { viewMonth = 1;  viewYear++; }
    if (viewMonth < 1)  { viewMonth = 12; viewYear--; }
    selectedIndex = -1;
    document.getElementById('selected-date').textContent = '×‘×—×¨ ×™×•× ××”×˜×‘×œ×” ×œ××˜×”';
    document.getElementById('input-in').value  = '';
    document.getElementById('input-out').value = '';
    loadMonth();
  }

  // â”€â”€ Clock In/Out â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clockIn() {
    const today = getTodayEntry();
    if (!today) return;
    if (today.dow === 5 || today.dow === 6) return; // Block Friday & Saturday
    const now = timeStr(new Date());
    today.clockIn  = now;
    today.clockOut = null;
    today.status   = 'work';
    shiftStartTime = Date.now();
    saveAndRefresh();
    updateTodayButtons();
  }

  function clockOut() {
    const today = getTodayEntry();
    if (!today) return;
    today.clockOut = timeStr(new Date());
    shiftStartTime = null;
    saveAndRefresh();
    updateTodayButtons();
  }

  function getTodayEntry() {
    const now = new Date();
    const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

    // if viewing current month
    if (viewYear === now.getFullYear() && viewMonth === now.getMonth()+1) {
      return currentMonth.find(d => d.date === dateStr) || null;
    }
    return null;
  }

  function updateTodayButtons() {
    const today = getTodayEntry();
    const isClockedIn = today && today.clockIn && !today.clockOut;
    const isShabbat   = today && (today.dow === 5 || today.dow === 6);

    document.getElementById('btn-in').disabled  = isShabbat || isClockedIn || (today && (today.status === 'sick' || today.status === 'vacation'));
    document.getElementById('btn-out').disabled = !isClockedIn;

    const statusEl = document.getElementById('work-status');
    if (isShabbat) {
      statusEl.textContent = '×©×‘×ª ğŸ•¯ï¸';
      statusEl.className   = 'status-badge status-shabbat';
    } else if (isClockedIn) {
      statusEl.textContent = '×‘×¢×‘×•×“×” ğŸŸ¢';
      statusEl.className   = 'status-badge status-in';
    } else {
      statusEl.textContent = '×œ× ×‘×¢×‘×•×“×” ğŸ”´';
      statusEl.className   = 'status-badge status-out';
    }
  }

  function updateTodayDisplay() {
    const today = getTodayEntry();
    const el = document.getElementById('today-display');
    if (!today) { el.textContent = ''; return; }
    el.textContent = `×”×™×•×: ${today.clockIn || '--:--'} - ${today.clockOut || '--:--'}`;
  }

  function timeStr(date) {
    return `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
  }

  // â”€â”€ Manual edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveManualHours() {
    if (selectedIndex < 0) { showMsg('×‘×—×¨ ×™×•× ×§×•×“×'); return; }
    const day = currentMonth[selectedIndex];
    if (day.status === 'weekend') { showMsg('×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ×¡×•×£ ×©×‘×•×¢'); return; }

    const inVal  = document.getElementById('input-in').value.trim();
    const outVal = document.getElementById('input-out').value.trim();

    if (inVal  && !/^\d{1,2}:\d{2}$/.test(inVal))  { showMsg('âš ï¸ ×¤×•×¨××˜ ×›× ×™×¡×” ×©×’×•×™ (HH:mm)'); return; }
    if (outVal && !/^\d{1,2}:\d{2}$/.test(outVal)) { showMsg('âš ï¸ ×¤×•×¨××˜ ×™×¦×™××” ×©×’×•×™ (HH:mm)'); return; }

    day.clockIn  = inVal  || null;
    day.clockOut = outVal || null;
    if (inVal || outVal) day.status = 'work';

    saveAndRefresh();
    showMsg('âœ… × ×©××¨ ×‘×”×¦×œ×—×”!');
    updateTodayButtons();
  }

  function markDay(type) {
    if (selectedIndex < 0) { showMsg('×‘×—×¨ ×™×•× ×§×•×“×'); return; }
    const day = currentMonth[selectedIndex];
    if (day.status === 'weekend') { showMsg('×œ× × ×™×ª×Ÿ ×œ×¡××Ÿ ×¡×•×£ ×©×‘×•×¢'); return; }

    if (type === 'sick')     { day.status = 'sick';    day.clockIn = null; day.clockOut = null; }
    if (type === 'vacation') { day.status = 'vacation'; day.clockIn = null; day.clockOut = null; }
    if (type === 'clear')    {
      const date = new Date(day.date);
      const now  = new Date();
      day.status   = (date > now) ? 'pending' : 'pending';
      day.clockIn  = null;
      day.clockOut = null;
    }

    document.getElementById('input-in').value  = '';
    document.getElementById('input-out').value = '';
    saveAndRefresh();
    showMsg('âœ… ×¢×•×“×›×Ÿ!');
  }

  function showMsg(msg) {
    const el = document.getElementById('save-msg');
    el.textContent = msg;
    setTimeout(() => { el.textContent = ''; }, 3000);
  }

  // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function calcHours(day) {
    if (day.status === 'sick' || day.status === 'vacation') return 9.0;
    if (day.clockIn && day.clockOut) {
      const [ih, im] = day.clockIn.split(':').map(Number);
      const [oh, om] = day.clockOut.split(':').map(Number);
      return Math.max(0, (oh * 60 + om - ih * 60 - im) / 60);
    }
    return 0;
  }

  function updateStats() {
    const workDays  = currentMonth.filter(d => d.status !== 'weekend' && d.status !== 'pending' || d.status === 'sick' || d.status === 'vacation' || d.status === 'work');
    const planned   = currentMonth.filter(d => d.status !== 'weekend');
    const target    = planned.length * 9;
    const worked    = currentMonth.reduce((s, d) => s + calcHours(d), 0);
    const remain    = Math.max(0, Math.min(target, 182) - worked);
    const daysWorked= currentMonth.filter(d => calcHours(d) > 0).length;
    const avg       = daysWorked > 0 ? worked / daysWorked : 0;
    const pct       = target > 0 ? Math.min(100, (worked / target) * 100) : 0;
    const sickDays  = currentMonth.filter(d => d.status === 'sick').length;
    const vacDays   = currentMonth.filter(d => d.status === 'vacation').length;

    document.getElementById('stat-worked').textContent = worked.toFixed(1) + 'h';
    document.getElementById('stat-target').textContent = target.toFixed(0) + 'h';
    document.getElementById('stat-remain').textContent = remain.toFixed(1) + 'h';
    document.getElementById('stat-avg').textContent    = avg.toFixed(1) + 'h';
    document.getElementById('stat-sick').textContent   = sickDays;
    document.getElementById('stat-vac').textContent    = vacDays;
    document.getElementById('progress-pct').textContent = pct.toFixed(0) + '%';
    document.getElementById('progress-fill').style.width = pct.toFixed(1) + '%';
  }

  // â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderTable() {
    const today = new Date();
    const tbody = document.getElementById('history-body');
    tbody.innerHTML = '';

    currentMonth.forEach((day, i) => {
      const date     = new Date(day.date);
      const hours    = calcHours(day);
      const hoursStr = hours > 0 ? hours.toFixed(1) + 'h' : '--';
      const isToday  = isSameDay(date, today);
      const dd       = String(date.getDate()).padStart(2,'0');
      const mm       = String(date.getMonth()+1).padStart(2,'0');

      const statusMap = {
        work:    { cls: 'status-work',    label: 'âœ… ×¢×‘×•×“×”' },
        sick:    { cls: 'status-sick',    label: 'ğŸ¥ ××—×œ×”' },
        vacation:{ cls: 'status-vac',     label: 'ğŸ–ï¸ ×—×•×¤×©×”' },
        weekend: { cls: 'status-weekend', label: 'â›” ×¡×•×¤"×©' },
        pending: { cls: 'status-pending', label: 'â³ ×¢×ª×™×“×™' },
      };
      const s = statusMap[day.status] || statusMap.pending;

      const tr = document.createElement('tr');
      if (isToday)         tr.classList.add('today-row');
      if (i === selectedIndex) tr.classList.add('selected');

      tr.innerHTML = `
        <td>${dd}/${mm}</td>
        <td>${day.dayName}</td>
        <td>${day.clockIn  || '--:--'}</td>
        <td>${day.clockOut || '--:--'}</td>
        <td>${hoursStr}</td>
        <td class="${s.cls}">${s.label}</td>
      `;

      tr.onclick = () => selectDay(i);
      tbody.appendChild(tr);
    });
  }

  function selectDay(i) {
    selectedIndex = i;
    const day = currentMonth[i];
    const date = new Date(day.date);
    const dd = String(date.getDate()).padStart(2,'0');
    const mm = String(date.getMonth()+1).padStart(2,'0');
    document.getElementById('selected-date').textContent = `${dd}/${mm}/${date.getFullYear()} â€” ${day.dayName}`;
    document.getElementById('input-in').value  = day.clockIn  || '';
    document.getElementById('input-out').value = day.clockOut || '';
    document.getElementById('save-msg').textContent = '';
    renderTable();
  }

  // â”€â”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveAndRefresh() {
    const key = getKey(viewYear, viewMonth);
    const obj = {};
    currentMonth.forEach(d => { obj[d.date] = { clockIn: d.clockIn, clockOut: d.clockOut, status: d.status }; });
    allData[key] = obj;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
    renderTable();
    updateStats();
  }

  init();

  // â”€â”€ Ripple on buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('click', function(e) {
    const btn = e.target.closest('.btn');
    if (!btn || btn.disabled) return;
    const rect = btn.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = e.clientX - rect.left - size / 2;
    const y = e.clientY - rect.top  - size / 2;
    const el = document.createElement('span');
    el.className = 'ripple-el';
    el.style.cssText = `width:${size}px;height:${size}px;left:${x}px;top:${y}px;`;
    btn.appendChild(el);
    setTimeout(() => el.remove(), 600);
  });
</script>
</body>
</html>
